name: Transmitir VÃ­deo

on:
  workflow_dispatch:
    inputs:
      artefato_url:
        description: 'URL do artefato com os vÃ­deos .ts e metadados'
        required: true
        type: string

jobs:
  transmitir:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Baixar artefato ZIP do link enviado
        run: |
          echo "ğŸ”— Baixando artefato de: ${{ inputs.artefato_url }}"
          curl -L "${{ inputs.artefato_url }}" -o artefato.zip

      - name: ğŸ“¦ Descompactar artefato
        run: |
          mkdir -p artefatos/video_final
          unzip artefato.zip -d artefatos/video_final || {
            echo "âŒ Erro ao descompactar. Verifique se o link Ã© vÃ¡lido ou se o artefato expirou.";
            exit 1;
          }

      - name: ğŸ“ Verificar estrutura dos arquivos extraÃ­dos
        run: |
          echo "ğŸ“‚ Listando estrutura completa do artefato:"
          find artefatos/video_final -type f

      - name: ğŸ“„ Mostrar conteÃºdo do ts_paths.json
        run: |
          echo "ğŸ“ ConteÃºdo de ts_paths.json:"
          cat artefatos/video_final/ts_paths.json || echo "âŒ ts_paths.json nÃ£o encontrado"

      - name: ğŸ“„ Mostrar conteÃºdo do stream_info.json
        run: |
          echo "ğŸ“ ConteÃºdo de stream_info.json:"
          cat artefatos/video_final/stream_info.json || echo "âŒ stream_info.json nÃ£o encontrado"

      - name: ğŸ“¦ Tamanho total dos arquivos
        run: |
          echo "ğŸ“ Tamanho total dos arquivos extraÃ­dos:"
          du -sh artefatos/video_final || echo "âš ï¸ Erro ao calcular tamanho"

      - name: ğŸ” Mostrar primeiros bytes de cada .ts
        run: |
          echo "ğŸ” Primeiros bytes de cada vÃ­deo .ts:"
          for f in artefatos/video_final/*.ts; do
            echo "--- $(basename "$f") ---"
            head -c 256 "$f" | hexdump -C
            echo ""
          done

      - name: ğŸ“¡ Pronto para transmissÃ£o (ainda nÃ£o iniciada)
        run: |
          echo "âœ… Artefatos preparados. TransmissÃ£o pode ser iniciada agora via ffmpeg ou outro sistema."
